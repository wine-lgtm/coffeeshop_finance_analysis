<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Company Overall Budget - Coffee Cashflow</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="side.css">
    <style>
        /* Page-specific override: hide the global sidebar when this page is opened directly */
        .sidebar { display: none !important; }
        /* Reset dashboard margin so content uses full width */
        #dashboard-section { margin-left: 0 !important; padding: 40px; }

    </style>
    <style>
        /* Faded / disabled look when month is outside allowed range (like category budget: not-allowed months appear greyed) */
        input[id="overall_budget_month"].month-out-of-range,
        input[id="overall_month_filter"].month-out-of-range {
            background-color: #e9ecef;
            border-color: #adb5bd;
            color: #6c757d;
            opacity: 0.8;
        }
        #overall_budget_month{

            background-color: #d4edda;
    border: 1px solid #28a745;
    color: #155724;
        }
        #overall_month_filter{
            background-color: #d4edda;
    border: 1px solid #28a745;
    color: #155724; 
        }

  
    </style>
</head>

<body>
    
    <div id="dashboard-section">
        
        <div id="budget-page" class="page-section active-section">
            <header class="dash-header">
                <h1>Company Overall Budget Management (Monthly)</h1>
                <button onclick="window.location.href='category_budget.html'; event.stopPropagation();" 
                style="background: #2ea44f; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; align-self: center;">
            Manage Category Budget
        </button>

                 <button onclick="window.location.href='budget_section.html'" style="background: #3498db; color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer;"><i class="fas fa-arrow-left"></i> Back to Budget Dashboard</button>
            </header>
            
            <div id="category-budget-section" class="manage-expense-card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3 id="form-title">Add New Monthly Overall Budget</h3>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <input type="month" id="overall_month_filter" onchange="loadOverallBudgets()" style="padding: 10px; border: 1px solid #ddd; border-radius: 8px;" title="Only current month through next 3 months" min="" max="">
                        <button onclick="loadOverallBudgets()" style="background: #2ea44f; color: white; border: none; padding: 10px 15px; border-radius: 8px; cursor: pointer;">Filter</button>
                    </div>
                </div>

                <div class="expense-table-input">
                    <input type="hidden" id="overall_budget_id">
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1.5fr auto; gap: 15px; align-items: end;">
                        <div>
                            <label style="font-size: 11px; font-weight: bold; color: #666; display: block; margin-bottom: 5px;">MONTH</label>
                            <input type="month" id="overall_budget_month" title="Only current month through next 3 months can be selected" min="" max="">
                            
                        </div>
                        <div>
                            <label style="font-size: 11px; font-weight: bold; color: #666; display: block; margin-bottom: 5px;">AMOUNT</label>
                            <input type="number" id="overall_budget_amount" placeholder="0.00">
                        </div>
                        <div>
                            <label style="font-size: 11px; font-weight: bold; color: #666; display: block; margin-bottom: 5px;">DESCRIPTION</label>
                            <input type="text" id="overall_budget_description" placeholder="e.g. Company total budget">
                        </div>
                        <div style="display: flex; gap: 5px;">
                            <button onclick="saveOverallBudget()" class="add-expense-btn" style="height: 42px;">Save Budget</button>
                            <button id="btn-cancel-edit-overall" onclick="clearOverallForm()" style="display: none; background: #999; color: white; border: none; padding: 0 15px; border-radius: 14px; cursor: pointer; height: 42px;">Cancel</button>
                        </div>
                    </div>
                </div>

                <h3 style="margin-top: 30px;">Monthly Overall Budget List</h3>
                
                <table>
                    <thead>
                        <tr>
                            <th>Month</th>
                            <th>Amount</th>
                            <th>Description</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="overall-budget-table-body">
                        <!-- Budget rows will be populated here -->
                    </tbody>
                </table>
            </div>
        </div>

        <div id="report-page" class="page-section">
            <div class="report-container" id="report-content-area">
                </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="newscript.js?v=3"></script>
    <script>
        // Inline: set month limits so they work even when page is served by backend (no dependency on overall_budget.js load)
        (function() {
            function getRange() {
                var now = new Date();
                var current = new Date(now.getFullYear(), now.getMonth(), 1);
                var max = new Date(now.getFullYear(), now.getMonth() + 3, 1);
                var toStr = function(d) {
                    var y = d.getFullYear(), m = d.getMonth() + 1;
                    return y + '-' + (m < 10 ? '0' : '') + m;
                };
                return { currentMonth: toStr(current), maxMonth: toStr(max) };
            }
            function applyLimits() {
                var r = getRange();
                var formMonth = document.getElementById('overall_budget_month');
                var filterMonth = document.getElementById('overall_month_filter');
                if (formMonth) { formMonth.min = r.currentMonth; formMonth.max = r.maxMonth; if (!formMonth.value) formMonth.value = r.currentMonth; }
                if (filterMonth) { filterMonth.min = r.currentMonth; filterMonth.max = r.maxMonth; if (!filterMonth.value) filterMonth.value = r.currentMonth; }
                var hint = document.getElementById('overall_month_hint');

            }
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', applyLimits);
            } else {
                applyLimits();
            }
        })();
    </script>

            <script src="overall_budget.js?v=3"></script>
    <script>
        // Inline: sync filter and table when form month changes (works even if overall_budget.js is cached on localhost)
        document.addEventListener('DOMContentLoaded', function() {
            var formMonth = document.getElementById('overall_budget_month');
            var filterInput = document.getElementById('overall_month_filter');
            if (!formMonth || !filterInput) return;
            formMonth.addEventListener('change', function() {
                var month = formMonth.value;
                if (!month) return;
                filterInput.value = month;
                if (typeof loadOverallBudgets === 'function') loadOverallBudgets();
            });
        });
    </script>
    <script>
        // If this page is opened inside another same-origin page, hide the parent's sidebar
        // while this page is active, and restore it when this page unloads.
        (function(){
            try {
                if (window.top && window.top !== window) {
                    const parentDoc = window.top.document;
                    const sidebar = parentDoc.querySelector('.sidebar');
                    const dashboard = parentDoc.querySelector('#dashboard-section');
                    if (sidebar) {
                        sidebar.dataset._prevDisplay = sidebar.style.display || '';
                        sidebar.style.display = 'none';
                    }
                    if (dashboard) {
                        dashboard.dataset._prevMargin = dashboard.style.marginLeft || '';
                        dashboard.style.marginLeft = '0';
                    }

                    window.addEventListener('beforeunload', function() {
                        try {
                            if (sidebar) {
                                sidebar.style.display = sidebar.dataset._prevDisplay || '';
                                delete sidebar.dataset._prevDisplay;
                            }
                            if (dashboard) {
                                dashboard.style.marginLeft = dashboard.dataset._prevMargin || '';
                                delete dashboard.dataset._prevMargin;
                            }
                        } catch (e) {
                            // ignore
                        }
                    });
                }
            } catch (e) {
                // cross-origin or other access error; nothing to do
            }
        })();
    </script>
    </script>
</body>
</html>